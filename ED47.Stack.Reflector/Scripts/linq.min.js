(function(n,t){var f={Identity:function(n){return n},True:function(){return!0},Blank:function(){}},o={Boolean:"boolean",Number:"number",String:"string",Object:"object",Undefined:typeof t,Function:typeof function(){}},r={createLambda:function(n){var c,t,l,r,u,i,e,s,a,h;if(n==null)return f.Identity;if(typeof n==o.String){if(n=="")return f.Identity;if(n.indexOf("=>")==-1){for(c=new RegExp("[$]+","g"),t=0;l=c.exec(n);)r=l[0].length,r>t&&(t=r);for(u=[],i=1;i<=t;i++){for(e="",s=0;s<i;s++)e+="$";u.push(e)}return a=Array.prototype.join.call(u,","),new Function(a,"return "+n)}return h=n.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/),new Function(h[1],"return "+h[2])}return n},isIEnumerable:function(n){if(typeof Enumerator!==o.Undefined)try{return new Enumerator(n),!0}catch(t){}return!1},isSupportDefineProperty:Object.defineProperties!=null,defineProperty:function(n,t,i){r.isSupportDefineProperty?Object.defineProperty(n,t,{enumerable:!1,configurable:!0,writable:!0,value:i}):n[t]=i},compare:function(n,t){return n===t?0:n>t?1:-1},dispose:function(n){n!=null&&n.dispose()}},l={Before:0,Running:1,After:2},u=function(n,t,i){var u=new w,r=l.Before;this.current=u.current;this.moveNext=function(){try{switch(r){case l.Before:r=l.Running;n();case l.Running:return t.apply(u)?!0:(this.dispose(),!1);case l.After:return!1}}catch(i){this.dispose();throw i;}};this.dispose=function(){if(r==l.Running)try{i()}finally{r=l.After}}},w=function(){var n=null;this.current=function(){return n};this.yieldReturn=function(t){return n=t,!0};this.yieldBreak=function(){return!1}},i=function(n){this.getEnumerator=n},s,a,y,e,h,c;i.Utils={};i.Utils.createLambda=function(n){return r.createLambda(n)};i.Utils.createEnumerable=function(n){return new i(n)};i.Utils.createEnumerator=function(n,t,i){return new u(n,t,i)};i.Utils.extendTo=function(n){var u=n.prototype,o,t,f;n instanceof Array?(o=e.prototype,r.defineProperty(u,"getSource",function(){return this})):(o=i.prototype,r.defineProperty(u,"getEnumerator",function(){return i.from(this).getEnumerator()}));for(t in o)(f=o[t],u[t]!=f)&&(u[t]==null||(t=t+"ByLinq",u[t]!=f))&&f instanceof Function&&r.defineProperty(u,t,f)};i.choice=function(){var n=arguments[0]instanceof Array?arguments[0]:arguments;return new i(function(){return new u(f.Blank,function(){return this.yieldReturn(n[Math.floor(Math.random()*n.length)])},f.Blank)})};i.cycle=function(){var n=arguments[0]instanceof Array?arguments[0]:arguments;return new i(function(){var t=0;return new u(f.Blank,function(){return t>=n.length&&(t=0),this.yieldReturn(n[t++])},f.Blank)})};i.empty=function(){return new i(function(){return new u(f.Blank,function(){return!1},f.Blank)})};i.from=function(n){if(n==null)return i.empty();if(n instanceof i)return n;if(typeof n==o.Number||typeof n==o.Boolean)return i.repeat(n,1);if(typeof n==o.String)return new i(function(){var t=0;return new u(f.Blank,function(){return t<n.length?this.yieldReturn(n.charAt(t++)):!1},f.Blank)});if(typeof n!=o.Function){if(typeof n.length==o.Number)return new e(n);if(!(n instanceof Object)&&r.isIEnumerable(n))return new i(function(){var i=!0,t;return new u(function(){t=new Enumerator(n)},function(){return i?i=!1:t.moveNext(),t.atEnd()?!1:this.yieldReturn(t.item())},f.Blank)})}return new i(function(){var t=[],i=0;return new u(function(){for(var i in n)n[i]instanceof Function||t.push({key:i,value:n[i]})},function(){return i<t.length?this.yieldReturn(t[i++]):!1},f.Blank)})};i.make=function(n){return i.repeat(n,1)};i.matches=function(n,t,r){return r==null&&(r=""),t instanceof RegExp&&(r+=t.ignoreCase?"i":"",r+=t.multiline?"m":"",t=t.source),r.indexOf("g")===-1&&(r+="g"),new i(function(){var i;return new u(function(){i=new RegExp(t,r)},function(){var t=i.exec(n);return t?this.yieldReturn(t):!1},f.Blank)})};i.range=function(n,t,r){return r==null&&(r=1),new i(function(){var i,e=0;return new u(function(){i=n-r},function(){return e++<t?this.yieldReturn(i+=r):this.yieldBreak()},f.Blank)})};i.rangeDown=function(n,t,r){return r==null&&(r=1),new i(function(){var i,e=0;return new u(function(){i=n+r},function(){return e++<t?this.yieldReturn(i-=r):this.yieldBreak()},f.Blank)})};i.rangeTo=function(n,t,r){return r==null&&(r=1),n<t?new i(function(){var i;return new u(function(){i=n-r},function(){var n=i+=r;return n<=t?this.yieldReturn(n):this.yieldBreak()},f.Blank)}):new i(function(){var i;return new u(function(){i=n+r},function(){var n=i-=r;return n>=t?this.yieldReturn(n):this.yieldBreak()},f.Blank)})};i.repeat=function(n,t){return t!=null?i.repeat(n).take(t):new i(function(){return new u(f.Blank,function(){return this.yieldReturn(n)},f.Blank)})};i.repeatWithFinalize=function(n,t){return n=r.createLambda(n),t=r.createLambda(t),new i(function(){var i;return new u(function(){i=n()},function(){return this.yieldReturn(i)},function(){i!=null&&(t(i),i=null)})})};i.generate=function(n,t){return t!=null?i.generate(n).take(t):(n=r.createLambda(n),new i(function(){return new u(f.Blank,function(){return this.yieldReturn(n())},f.Blank)}))};i.toInfinity=function(n,t){return n==null&&(n=0),t==null&&(t=1),new i(function(){var i;return new u(function(){i=n-t},function(){return this.yieldReturn(i+=t)},f.Blank)})};i.toNegativeInfinity=function(n,t){return n==null&&(n=0),t==null&&(t=1),new i(function(){var i;return new u(function(){i=n+t},function(){return this.yieldReturn(i-=t)},f.Blank)})};i.unfold=function(n,t){return t=r.createLambda(t),new i(function(){var r=!0,i;return new u(f.Blank,function(){return r?(r=!1,i=n,this.yieldReturn(i)):(i=t(i),this.yieldReturn(i))},f.Blank)})};i.defer=function(n){return new i(function(){return new u(function(){enumerator=i.from(n()).getEnumerator()},function(){return enumerator.moveNext()?this.yieldReturn(enumerator.current()):this.yieldBreak()},function(){r.dispose(enumerator)})})};i.prototype.traverseBreadthFirst=function(n,t){var f=this;return n=r.createLambda(n),t=r.createLambda(t),new i(function(){var e,s=0,o=[];return new u(function(){e=f.getEnumerator()},function(){for(;;){if(e.moveNext())return o.push(e.current()),this.yieldReturn(t(e.current(),s));var u=i.from(o).selectMany(function(t){return n(t)});if(u.any())s++,o=[],r.dispose(e),e=u.getEnumerator();else return!1}},function(){r.dispose(e)})})};i.prototype.traverseDepthFirst=function(n,t){var f=this;return n=r.createLambda(n),t=r.createLambda(t),new i(function(){var o=[],e;return new u(function(){e=f.getEnumerator()},function(){for(;;){if(e.moveNext()){var u=t(e.current(),o.length);return o.push(e),e=i.from(n(e.current())).getEnumerator(),this.yieldReturn(u)}if(o.length<=0)return!1;r.dispose(e);e=o.pop()}},function(){try{r.dispose(e)}finally{i.from(o).forEach(function(n){n.dispose()})}})})};i.prototype.flatten=function(){var n=this;return new i(function(){var e,t=null;return new u(function(){e=n.getEnumerator()},function(){for(;;){if(t!=null){if(t.moveNext())return this.yieldReturn(t.current());t=null}if(e.moveNext())if(e.current()instanceof Array){r.dispose(t);t=i.from(e.current()).selectMany(f.Identity).flatten().getEnumerator();continue}else return this.yieldReturn(e.current());return!1}},function(){try{r.dispose(e)}finally{r.dispose(t)}})})};i.prototype.pairwise=function(n){var t=this;return n=r.createLambda(n),new i(function(){var i;return new u(function(){i=t.getEnumerator();i.moveNext()},function(){var t=i.current();return i.moveNext()?this.yieldReturn(n(t,i.current())):!1},function(){r.dispose(i)})})};i.prototype.scan=function(n,t,f){var e,o;return f!=null?this.scan(n,t).select(f):(t==null?(t=r.createLambda(n),e=!1):(t=r.createLambda(t),e=!0),o=this,new i(function(){var i,f,s=!0;return new u(function(){i=o.getEnumerator()},function(){if(s){if(s=!1,e)return this.yieldReturn(f=n);if(i.moveNext())return this.yieldReturn(f=i.current())}return i.moveNext()?this.yieldReturn(f=t(f,i.current())):!1},function(){r.dispose(i)})}))};i.prototype.select=function(n){if(n=r.createLambda(n),n.length<=1)return new c(this,null,n);var t=this;return new i(function(){var i,f=0;return new u(function(){i=t.getEnumerator()},function(){return i.moveNext()?this.yieldReturn(n(i.current(),f++)):!1},function(){r.dispose(i)})})};i.prototype.selectMany=function(n,f){var e=this;return n=r.createLambda(n),f==null&&(f=function(n,t){return t}),f=r.createLambda(f),new i(function(){var s,o=t,h=0;return new u(function(){s=e.getEnumerator()},function(){if(o===t&&!s.moveNext())return!1;do{if(o==null){var u=n(s.current(),h++);o=i.from(u).getEnumerator()}if(o.moveNext())return this.yieldReturn(f(s.current(),o.current()));r.dispose(o);o=null}while(s.moveNext());return!1},function(){try{r.dispose(s)}finally{r.dispose(o)}})})};i.prototype.where=function(n){if(n=r.createLambda(n),n.length<=1)return new h(this,n);var t=this;return new i(function(){var i,f=0;return new u(function(){i=t.getEnumerator()},function(){while(i.moveNext())if(n(i.current(),f++))return this.yieldReturn(i.current());return!1},function(){r.dispose(i)})})};i.prototype.choose=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i,f=0;return new u(function(){i=t.getEnumerator()},function(){while(i.moveNext()){var t=n(i.current(),f++);if(t!=null)return this.yieldReturn(t)}return this.yieldBreak()},function(){r.dispose(i)})})};i.prototype.ofType=function(n){var t;switch(n){case Number:t=o.Number;break;case String:t=o.String;break;case Boolean:t=o.Boolean;break;case Function:t=o.Function;break;default:t=null}return t===null?this.where(function(t){return t instanceof n}):this.where(function(n){return typeof n===t})};i.prototype.zip=function(){var e=arguments,n=r.createLambda(arguments[arguments.length-1]),t=this,f;return arguments.length==2?(f=arguments[0],new i(function(){var e,o,s=0;return new u(function(){e=t.getEnumerator();o=i.from(f).getEnumerator()},function(){return e.moveNext()&&o.moveNext()?this.yieldReturn(n(e.current(),o.current(),s++)):!1},function(){try{r.dispose(e)}finally{r.dispose(o)}})})):new i(function(){var f,o=0;return new u(function(){var n=i.make(t).concat(i.from(e).takeExceptLast().select(i.from)).select(function(n){return n.getEnumerator()}).toArray();f=i.from(n)},function(){if(f.all(function(n){return n.moveNext()})){var t=f.select(function(n){return n.current()}).toArray();return t.push(o++),this.yieldReturn(n.apply(null,t))}return this.yieldBreak()},function(){i.from(f).forEach(r.dispose)})})};i.prototype.merge=function(){var n=arguments,t=this;return new i(function(){var f,e=-1;return new u(function(){f=i.make(t).concat(i.from(n).select(i.from)).select(function(n){return n.getEnumerator()}).toArray()},function(){while(f.length>0){e=e>=f.length-1?0:e+1;var n=f[e];if(n.moveNext())return this.yieldReturn(n.current());n.dispose();f.splice(e--,1)}return this.yieldBreak()},function(){i.from(f).forEach(r.dispose)})})};i.prototype.join=function(n,e,o,s,h){e=r.createLambda(e);o=r.createLambda(o);s=r.createLambda(s);h=r.createLambda(h);var c=this;return new i(function(){var l,v,a=null,y=0;return new u(function(){l=c.getEnumerator();v=i.from(n).toLookup(o,f.Identity,h)},function(){for(var n,i;;){if(a!=null){if(n=a[y++],n!==t)return this.yieldReturn(s(l.current(),n));n=null;y=0}if(l.moveNext())i=e(l.current()),a=v.get(i).toArray();else return!1}},function(){r.dispose(l)})})};i.prototype.groupJoin=function(n,t,e,o,s){t=r.createLambda(t);e=r.createLambda(e);o=r.createLambda(o);s=r.createLambda(s);var h=this;return new i(function(){var c=h.getEnumerator(),l=null;return new u(function(){c=h.getEnumerator();l=i.from(n).toLookup(e,f.Identity,s)},function(){if(c.moveNext()){var n=l.get(t(c.current()));return this.yieldReturn(o(c.current(),n))}return!1},function(){r.dispose(c)})})};i.prototype.all=function(n){n=r.createLambda(n);var t=!0;return this.forEach(function(i){if(!n(i))return t=!1,!1}),t};i.prototype.any=function(n){n=r.createLambda(n);var t=this.getEnumerator();try{if(arguments.length==0)return t.moveNext();while(t.moveNext())if(n(t.current()))return!0;return!1}finally{r.dispose(t)}};i.prototype.isEmpty=function(){return!this.any()};i.prototype.concat=function(){var n=this,t,f;return arguments.length==1?(t=arguments[0],new i(function(){var e,f;return new u(function(){e=n.getEnumerator()},function(){if(f==null){if(e.moveNext())return this.yieldReturn(e.current());f=i.from(t).getEnumerator()}return f.moveNext()?this.yieldReturn(f.current()):!1},function(){try{r.dispose(e)}finally{r.dispose(f)}})})):(f=arguments,new i(function(){var t;return new u(function(){t=i.make(n).concat(i.from(f).select(i.from)).select(function(n){return n.getEnumerator()}).toArray()},function(){while(t.length>0){var n=t[0];if(n.moveNext())return this.yieldReturn(n.current());n.dispose();t.splice(0,1)}return this.yieldBreak()},function(){i.from(t).forEach(r.dispose)})}))};i.prototype.insert=function(n,t){var f=this;return new i(function(){var o,e,s=0,h=!1;return new u(function(){o=f.getEnumerator();e=i.from(t).getEnumerator()},function(){return s==n&&e.moveNext()?(h=!0,this.yieldReturn(e.current())):o.moveNext()?(s++,this.yieldReturn(o.current())):!h&&e.moveNext()?this.yieldReturn(e.current()):!1},function(){try{r.dispose(o)}finally{r.dispose(e)}})})};i.prototype.alternate=function(n){return n=i.make(n),this.selectMany(function(t){return i.make(t).concat(n)}).takeExceptLast()};i.prototype.contains=function(n,t){t=r.createLambda(t);var i=this.getEnumerator();try{while(i.moveNext())if(t(i.current())===n)return!0;return!1}finally{r.dispose(i)}};i.prototype.defaultIfEmpty=function(n){var t=this;return new i(function(){var i,f=!0;return new u(function(){i=t.getEnumerator()},function(){return i.moveNext()?(f=!1,this.yieldReturn(i.current())):f?(f=!1,this.yieldReturn(n)):!1},function(){r.dispose(i)})})};i.prototype.distinct=function(n){return this.except(i.empty(),n)};i.prototype.distinctUntilChanged=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i,f,e;return new u(function(){i=t.getEnumerator()},function(){while(i.moveNext()){var t=n(i.current());if(e)return e=!1,f=t,this.yieldReturn(i.current());if(f!==t)return f=t,this.yieldReturn(i.current())}return this.yieldBreak()},function(){r.dispose(i)})})};i.prototype.except=function(n,t){t=r.createLambda(t);var f=this;return new i(function(){var e,o;return new u(function(){e=f.getEnumerator();o=new v(t);i.from(n).forEach(function(n){o.add(n)})},function(){while(e.moveNext()){var n=e.current();if(!o.contains(n))return o.add(n),this.yieldReturn(n)}return!1},function(){r.dispose(e)})})};i.prototype.intersect=function(n,t){t=r.createLambda(t);var f=this;return new i(function(){var e,o,s;return new u(function(){e=f.getEnumerator();o=new v(t);i.from(n).forEach(function(n){o.add(n)});s=new v(t)},function(){while(e.moveNext()){var n=e.current();if(!s.contains(n)&&o.contains(n))return s.add(n),this.yieldReturn(n)}return!1},function(){r.dispose(e)})})};i.prototype.sequenceEqual=function(n,t){var f,u;t=r.createLambda(t);f=this.getEnumerator();try{u=i.from(n).getEnumerator();try{while(f.moveNext())if(!u.moveNext()||t(f.current())!==t(u.current()))return!1;return u.moveNext()?!1:!0}finally{r.dispose(u)}}finally{r.dispose(f)}};i.prototype.union=function(n,f){f=r.createLambda(f);var e=this;return new i(function(){var h,o,s;return new u(function(){h=e.getEnumerator();s=new v(f)},function(){var r;if(o===t){while(h.moveNext())if(r=h.current(),!s.contains(r))return s.add(r),this.yieldReturn(r);o=i.from(n).getEnumerator()}while(o.moveNext())if(r=o.current(),!s.contains(r))return s.add(r),this.yieldReturn(r);return!1},function(){try{r.dispose(h)}finally{r.dispose(o)}})})};i.prototype.orderBy=function(n){return new s(this,n,!1)};i.prototype.orderByDescending=function(n){return new s(this,n,!0)};i.prototype.reverse=function(){var n=this;return new i(function(){var t,i;return new u(function(){t=n.toArray();i=t.length},function(){return i>0?this.yieldReturn(t[--i]):!1},f.Blank)})};i.prototype.shuffle=function(){var n=this;return new i(function(){var t;return new u(function(){t=n.toArray()},function(){if(t.length>0){var n=Math.floor(Math.random()*t.length);return this.yieldReturn(t.splice(n,1)[0])}return!1},f.Blank)})};i.prototype.weightedSample=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i,r=0;return new u(function(){i=t.choose(function(t){var i=n(t);return i<=0?null:(r+=i,{value:t,bound:r})}).toArray()},function(){var t;if(i.length>0){for(var f=Math.floor(Math.random()*r)+1,u=-1,n=i.length;n-u>1;)t=Math.floor((u+n)/2),i[t].bound>=f?n=t:u=t;return this.yieldReturn(i[n].value)}return this.yieldBreak()},f.Blank)})};i.prototype.groupBy=function(n,t,f,e){var o=this;return n=r.createLambda(n),t=r.createLambda(t),f!=null&&(f=r.createLambda(f)),e=r.createLambda(e),new i(function(){var i;return new u(function(){i=o.toLookup(n,t,e).toEnumerable().getEnumerator()},function(){while(i.moveNext())return f==null?this.yieldReturn(i.current()):this.yieldReturn(f(i.current().key(),i.current()));return!1},function(){r.dispose(i)})})};i.prototype.partitionBy=function(n,t,f,e){var s=this,o;return n=r.createLambda(n),t=r.createLambda(t),e=r.createLambda(e),f==null?(o=!1,f=function(n,t){return new p(n,t)}):(o=!0,f=r.createLambda(f)),new i(function(){var h,l,a,c=[];return new u(function(){h=s.getEnumerator();h.moveNext()&&(l=n(h.current()),a=e(l),c.push(t(h.current())))},function(){for(var r,u;(r=h.moveNext())==!0;)if(a===e(n(h.current())))c.push(t(h.current()));else break;return c.length>0?(u=o?f(l,i.from(c)):f(l,c),r?(l=n(h.current()),a=e(l),c=[t(h.current())]):c=[],this.yieldReturn(u)):!1},function(){r.dispose(h)})})};i.prototype.buffer=function(n){var t=this;return new i(function(){var i;return new u(function(){i=t.getEnumerator()},function(){for(var t=[],r=0;i.moveNext();)if(t.push(i.current()),++r>=n)return this.yieldReturn(t);return t.length>0?this.yieldReturn(t):!1},function(){r.dispose(i)})})};i.prototype.aggregate=function(n,t,i){return this.scan(n,t,i).last()};i.prototype.average=function(n){n=r.createLambda(n);var t=0,i=0;return this.forEach(function(r){t+=n(r);++i}),t/i};i.prototype.count=function(n){n=n==null?f.True:r.createLambda(n);var t=0;return this.forEach(function(i,r){n(i,r)&&++t}),t};i.prototype.max=function(n){return n==null&&(n=f.Identity),this.select(n).aggregate(function(n,t){return n>t?n:t})};i.prototype.min=function(n){return n==null&&(n=f.Identity),this.select(n).aggregate(function(n,t){return n<t?n:t})};i.prototype.maxBy=function(n){return n=r.createLambda(n),this.aggregate(function(t,i){return n(t)>n(i)?t:i})};i.prototype.minBy=function(n){return n=r.createLambda(n),this.aggregate(function(t,i){return n(t)<n(i)?t:i})};i.prototype.sum=function(n){return n==null&&(n=f.Identity),this.select(n).aggregate(0,function(n,t){return n+t})};i.prototype.elementAt=function(n){var t,i=!1;if(this.forEach(function(r,u){if(u==n)return t=r,i=!0,!1}),!i)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return t};i.prototype.elementAtOrDefault=function(n,t){var i,r=!1;return this.forEach(function(t,u){if(u==n)return i=t,r=!0,!1}),r?i:t};i.prototype.first=function(n){if(n!=null)return this.where(n).first();var t,i=!1;if(this.forEach(function(n){return t=n,i=!0,!1}),!i)throw new Error("first:No element satisfies the condition.");return t};i.prototype.firstOrDefault=function(n,t){if(t!=null)return this.where(t).firstOrDefault(n);var i,r=!1;return this.forEach(function(n){return i=n,r=!0,!1}),r?i:n};i.prototype.last=function(n){if(n!=null)return this.where(n).last();var t,i=!1;if(this.forEach(function(n){i=!0;t=n}),!i)throw new Error("last:No element satisfies the condition.");return t};i.prototype.lastOrDefault=function(n,t){if(t!=null)return this.where(t).lastOrDefault(n);var i,r=!1;return this.forEach(function(n){r=!0;i=n}),r?i:n};i.prototype.single=function(n){if(n!=null)return this.where(n).single();var i,t=!1;if(this.forEach(function(n){if(t)throw new Error("single:sequence contains more than one element.");else t=!0,i=n}),!t)throw new Error("single:No element satisfies the condition.");return i};i.prototype.singleOrDefault=function(n,t){if(t!=null)return this.where(t).singleOrDefault(n);var r,i=!1;return this.forEach(function(n){if(i)throw new Error("single:sequence contains more than one element.");else i=!0,r=n}),i?r:n};i.prototype.skip=function(n){var t=this;return new i(function(){var i,f=0;return new u(function(){for(i=t.getEnumerator();f++<n&&i.moveNext(););},function(){return i.moveNext()?this.yieldReturn(i.current()):!1},function(){r.dispose(i)})})};i.prototype.skipWhile=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i,e=0,f=!1;return new u(function(){i=t.getEnumerator()},function(){while(!f)if(i.moveNext()){if(!n(i.current(),e++))return f=!0,this.yieldReturn(i.current());continue}else return!1;return i.moveNext()?this.yieldReturn(i.current()):!1},function(){r.dispose(i)})})};i.prototype.take=function(n){var t=this;return new i(function(){var i,f=0;return new u(function(){i=t.getEnumerator()},function(){return f++<n&&i.moveNext()?this.yieldReturn(i.current()):!1},function(){r.dispose(i)})})};i.prototype.takeWhile=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i,f=0;return new u(function(){i=t.getEnumerator()},function(){return i.moveNext()&&n(i.current(),f++)?this.yieldReturn(i.current()):!1},function(){r.dispose(i)})})};i.prototype.takeExceptLast=function(n){n==null&&(n=1);var t=this;return new i(function(){if(n<=0)return t.getEnumerator();var i,f=[];return new u(function(){i=t.getEnumerator()},function(){while(i.moveNext()){if(f.length==n)return f.push(i.current()),this.yieldReturn(f.shift());f.push(i.current())}return!1},function(){r.dispose(i)})})};i.prototype.takeFromLast=function(n){if(n<=0||n==null)return i.empty();var t=this;return new i(function(){var o,f,e=[];return new u(function(){o=t.getEnumerator()},function(){while(o.moveNext())e.length==n&&e.shift(),e.push(o.current());return f==null&&(f=i.from(e).getEnumerator()),f.moveNext()?this.yieldReturn(f.current()):!1},function(){r.dispose(f)})})};i.prototype.indexOf=function(n){var t=null;return this.forEach(function(i,r){if(i===n)return t=r,!0}),t!==null?t:-1};i.prototype.lastIndexOf=function(n){var t=-1;return this.forEach(function(i,r){i===n&&(t=r)}),t};i.prototype.asEnumerable=function(){return i.from(this)};i.prototype.toArray=function(){var n=[];return this.forEach(function(t){n.push(t)}),n};i.prototype.toLookup=function(n,i,u){n=r.createLambda(n);i=r.createLambda(i);u=r.createLambda(u);var f=new v(u);return this.forEach(function(r){var u=n(r),e=i(r),o=f.get(u);o!==t?o.push(e):f.add(u,[e])}),new b(f)};i.prototype.toObject=function(n,t){n=r.createLambda(n);t=r.createLambda(t);var i={};return this.forEach(function(r){i[n(r)]=t(r)}),i};i.prototype.toDictionary=function(n,t,i){n=r.createLambda(n);t=r.createLambda(t);i=r.createLambda(i);var u=new v(i);return this.forEach(function(i){u.add(n(i),t(i))}),u};i.prototype.toJSONString=function(n,t){if(typeof JSON===o.Undefined||JSON.stringify==null)throw new Error("toJSONString can't find JSON.stringify. This works native JSON support Browser or include json2.js");return JSON.stringify(this.toArray(),n,t)};i.prototype.toJoinedString=function(n,t){return n==null&&(n=""),t==null&&(t=f.Identity),this.select(t).toArray().join(n)};i.prototype.doAction=function(n){var t=this;return n=r.createLambda(n),new i(function(){var i,f=0;return new u(function(){i=t.getEnumerator()},function(){return i.moveNext()?(n(i.current(),f++),this.yieldReturn(i.current())):!1},function(){r.dispose(i)})})};i.prototype.forEach=function(n){n=r.createLambda(n);var i=0,t=this.getEnumerator();try{while(t.moveNext())if(n(t.current(),i++)===!1)break}finally{r.dispose(t)}};i.prototype.write=function(n,t){n==null&&(n="");t=r.createLambda(t);var i=!0;this.forEach(function(r){i?i=!1:document.write(n);document.write(t(r))})};i.prototype.writeLine=function(n,t){n==null&&(n="");t=r.createLambda(t);var i=!0;this.forEach(function(r){i?i=!1:document.writeln(n);document.writeln(t(r))})};i.prototype.force=function(){var n=this.getEnumerator();try{while(n.moveNext());}finally{r.dispose(n)}};i.prototype.letBind=function(n){n=r.createLambda(n);var t=this;return new i(function(){var f;return new u(function(){f=i.from(n(t)).getEnumerator()},function(){return f.moveNext()?this.yieldReturn(f.current()):!1},function(){r.dispose(f)})})};i.prototype.share=function(){var i=this,n,t=!1;return new y(function(){return new u(function(){n==null&&(n=i.getEnumerator())},function(){if(t)throw new Error("enumerator is disposed");return n.moveNext()?this.yieldReturn(n.current()):!1},f.Blank)},function(){t=!0;r.dispose(n)})};i.prototype.memoize=function(){var e=this,n,t,i=!1;return new y(function(){var r=-1;return new u(function(){t==null&&(t=e.getEnumerator(),n=[])},function(){if(i)throw new Error("enumerator is disposed");return(r++,n.length<=r)?t.moveNext()?this.yieldReturn(n[r]=t.current()):!1:this.yieldReturn(n[r])},f.Blank)},function(){i=!0;r.dispose(t);n=null})};i.prototype.catchError=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i;return new u(function(){i=t.getEnumerator()},function(){try{return i.moveNext()?this.yieldReturn(i.current()):!1}catch(t){return n(t),!1}},function(){r.dispose(i)})})};i.prototype.finallyAction=function(n){n=r.createLambda(n);var t=this;return new i(function(){var i;return new u(function(){i=t.getEnumerator()},function(){return i.moveNext()?this.yieldReturn(i.current()):!1},function(){try{r.dispose(i)}finally{n()}})})};i.prototype.log=function(n){return n=r.createLambda(n),this.doAction(function(t){typeof console!==o.Undefined&&console.log(n(t))})};i.prototype.trace=function(n,t){return n==null&&(n="Trace"),t=r.createLambda(t),this.doAction(function(i){typeof console!==o.Undefined&&console.log(n,t(i))})};s=function(n,t,i,u){this.source=n;this.keySelector=r.createLambda(t);this.descending=i;this.parent=u};s.prototype=new i;s.prototype.createOrderedEnumerable=function(n,t){return new s(this.source,n,t,this)};s.prototype.thenBy=function(n){return this.createOrderedEnumerable(n,!1)};s.prototype.thenByDescending=function(n){return this.createOrderedEnumerable(n,!0)};s.prototype.getEnumerator=function(){var i=this,t,n,r=0;return new u(function(){t=[];n=[];i.source.forEach(function(i,r){t.push(i);n.push(r)});var r=a.create(i,null);r.GenerateKeys(t);n.sort(function(n,t){return r.compare(n,t)})},function(){return r<n.length?this.yieldReturn(t[n[r++]]):!1},f.Blank)};a=function(n,t,i){this.keySelector=n;this.descending=t;this.child=i;this.keys=null};a.create=function(n,t){var i=new a(n.keySelector,n.descending,t);return n.parent!=null?a.create(n.parent,i):i};a.prototype.GenerateKeys=function(n){for(var i=n.length,u=this.keySelector,r=new Array(i),t=0;t<i;t++)r[t]=u(n[t]);this.keys=r;this.child!=null&&this.child.GenerateKeys(n)};a.prototype.compare=function(n,t){var i=r.compare(this.keys[n],this.keys[t]);if(i==0){if(this.child!=null)return this.child.compare(n,t);i=r.compare(n,t)}return this.descending?-i:i};y=function(n,t){this.dispose=t;i.call(this,n)};y.prototype=new i;e=function(n){this.getSource=function(){return n}};e.prototype=new i;e.prototype.any=function(n){return n==null?this.getSource().length>0:i.prototype.any.apply(this,arguments)};e.prototype.count=function(n){return n==null?this.getSource().length:i.prototype.count.apply(this,arguments)};e.prototype.elementAt=function(n){var t=this.getSource();return 0<=n&&n<t.length?t[n]:i.prototype.elementAt.apply(this,arguments)};e.prototype.elementAtOrDefault=function(n,t){var i=this.getSource();return 0<=n&&n<i.length?i[n]:t};e.prototype.first=function(n){var t=this.getSource();return n==null&&t.length>0?t[0]:i.prototype.first.apply(this,arguments)};e.prototype.firstOrDefault=function(n,t){if(t!=null)return i.prototype.firstOrDefault.apply(this,arguments);var r=this.getSource();return r.length>0?r[0]:n};e.prototype.last=function(n){var t=this.getSource();return n==null&&t.length>0?t[t.length-1]:i.prototype.last.apply(this,arguments)};e.prototype.lastOrDefault=function(n,t){if(t!=null)return i.prototype.lastOrDefault.apply(this,arguments);var r=this.getSource();return r.length>0?r[r.length-1]:n};e.prototype.skip=function(n){var t=this.getSource();return new i(function(){var i;return new u(function(){i=n<0?0:n},function(){return i<t.length?this.yieldReturn(t[i++]):!1},f.Blank)})};e.prototype.takeExceptLast=function(n){return n==null&&(n=1),this.take(this.getSource().length-n)};e.prototype.takeFromLast=function(n){return this.skip(this.getSource().length-n)};e.prototype.reverse=function(){var n=this.getSource();return new i(function(){var t;return new u(function(){t=n.length},function(){return t>0?this.yieldReturn(n[--t]):!1},f.Blank)})};e.prototype.sequenceEqual=function(n,t){return(n instanceof e||n instanceof Array)&&t==null&&i.from(n).count()!=this.count()?!1:i.prototype.sequenceEqual.apply(this,arguments)};e.prototype.toJoinedString=function(n,t){var r=this.getSource();return t!=null||!(r instanceof Array)?i.prototype.toJoinedString.apply(this,arguments):(n==null&&(n=""),r.join(n))};e.prototype.getEnumerator=function(){var n=this.getSource(),t=-1;return{current:function(){return n[t]},moveNext:function(){return++t<n.length},dispose:f.Blank}};h=function(n,t){this.prevSource=n;this.prevPredicate=t};h.prototype=new i;h.prototype.where=function(n){if(n=r.createLambda(n),n.length<=1){var t=this.prevPredicate,u=function(i){return t(i)&&n(i)};return new h(this.prevSource,u)}return i.prototype.where.call(this,n)};h.prototype.select=function(n){return n=r.createLambda(n),n.length<=1?new c(this.prevSource,this.prevPredicate,n):i.prototype.select.call(this,n)};h.prototype.getEnumerator=function(){var t=this.prevPredicate,i=this.prevSource,n;return new u(function(){n=i.getEnumerator()},function(){while(n.moveNext())if(t(n.current()))return this.yieldReturn(n.current());return!1},function(){r.dispose(n)})};c=function(n,t,i){this.prevSource=n;this.prevPredicate=t;this.prevSelector=i};c.prototype=new i;c.prototype.where=function(n){return n=r.createLambda(n),n.length<=1?new h(this,n):i.prototype.where.call(this,n)};c.prototype.select=function(n){if(n=r.createLambda(n),n.length<=1){var t=this.prevSelector,u=function(i){return n(t(i))};return new c(this.prevSource,this.prevPredicate,u)}return i.prototype.select.call(this,n)};c.prototype.getEnumerator=function(){var t=this.prevPredicate,i=this.prevSelector,f=this.prevSource,n;return new u(function(){n=f.getEnumerator()},function(){while(n.moveNext())if(t==null||t(n.current()))return this.yieldReturn(i(n.current()));return!1},function(){r.dispose(n)})};var v=function(){var n=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r=function(n){return n===null?"null":n===t?"undefined":typeof n.toString===o.Function?n.toString():Object.prototype.toString.call(n)},h=function(n,t){this.key=n;this.value=t;this.prev=null;this.next=null},e=function(){this.first=null;this.last=null},s;return e.prototype={addLast:function(n){this.last!=null?(this.last.next=n,n.prev=this.last,this.last=n):this.first=this.last=n},replace:function(n,t){n.prev!=null?(n.prev.next=t,t.prev=n.prev):this.first=t;n.next!=null?(n.next.prev=t,t.next=n.next):this.last=t},remove:function(n){n.prev!=null?n.prev.next=n.next:this.first=n.next;n.next!=null?n.next.prev=n.prev:this.last=n.prev}},s=function(n){this.countField=0;this.entryList=new e;this.buckets={};this.compareSelector=n==null?f.Identity:n},s.prototype={add:function(t,i){var s=this.compareSelector(t),o=r(s),e=new h(t,i),u,f;if(n(this.buckets,o)){for(u=this.buckets[o],f=0;f<u.length;f++)if(this.compareSelector(u[f].key)===s){this.entryList.replace(u[f],e);u[f]=e;return}u.push(e)}else this.buckets[o]=[e];this.countField++;this.entryList.addLast(e)},get:function(i){var o=this.compareSelector(i),s=r(o),f,u,e;if(!n(this.buckets,s))return t;for(f=this.buckets[s],u=0;u<f.length;u++)if(e=f[u],this.compareSelector(e.key)===o)return e.value;return t},set:function(t,i){var o=this.compareSelector(t),s=r(o),f,u,e;if(n(this.buckets,s))for(f=this.buckets[s],u=0;u<f.length;u++)if(this.compareSelector(f[u].key)===o)return e=new h(t,i),this.entryList.replace(f[u],e),f[u]=e,!0;return!1},contains:function(t){var f=this.compareSelector(t),e=r(f),u,i;if(!n(this.buckets,e))return!1;for(u=this.buckets[e],i=0;i<u.length;i++)if(this.compareSelector(u[i].key)===f)return!0;return!1},clear:function(){this.countField=0;this.buckets={};this.entryList=new e},remove:function(t){var e=this.compareSelector(t),f=r(e),i,u;if(n(this.buckets,f))for(i=this.buckets[f],u=0;u<i.length;u++)if(this.compareSelector(i[u].key)===e){this.entryList.remove(i[u]);i.splice(u,1);i.length==0&&delete this.buckets[f];this.countField--;return}},count:function(){return this.countField},toEnumerable:function(){var n=this;return new i(function(){var t;return new u(function(){t=n.entryList.first},function(){if(t!=null){var n={key:t.key,value:t.value};return t=t.next,this.yieldReturn(n)}return!1},f.Blank)})}},s}(),b=function(n){this.count=function(){return n.count()};this.get=function(t){return i.from(n.get(t))};this.contains=function(t){return n.contains(t)};this.toEnumerable=function(){return n.toEnumerable().select(function(n){return new p(n.key,n.value)})}},p=function(n,t){this.key=function(){return n};e.call(this,t)};p.prototype=new e;typeof module!==o.Undefined&&module.exports?module.exports=i:n.Enumerable=i})(this);